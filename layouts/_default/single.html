{{ define "main" }}
  {{- $images := .Resources.ByType "image" }}
  {{- $cover := $images.GetMatch (.Params.cover | default "*cover*") }}
  {{- $feature := $images.GetMatch (.Params.feature | default "*feature*") | default $cover }}
  <article class="w-full">
    <!-- 헤더: 중앙 정렬, 적당한 너비 -->
    <header class="w-full max-w-3xl mx-auto px-4">
      {{ if .Params.showBreadcrumbs | default (.Site.Params.article.showBreadcrumbs | default false) }}
        {{ partial "breadcrumbs.html" . }}
      {{ end }}
      <h1 class="mb-4 mt-0 text-3xl font-extrabold text-neutral-900 dark:text-neutral">
        {{ .Title | emojify }}
      </h1>
      {{ if or
        (.Params.showDate | default (.Site.Params.article.showDate | default true))
        (and (.Params.showDateUpdated | default (.Site.Params.article.showDateUpdated | default false)) (ne (partial "functions/date.html" .Date) (partial "functions/date.html" .Lastmod)))
        (and (.Params.showWordCount | default (.Site.Params.article.showWordCount | default false)) (ne .WordCount 0))
        (and (.Params.showReadingTime | default (.Site.Params.article.showReadingTime | default true)) (ne .ReadingTime 0))
        (.Params.showEdit | default (.Site.Params.article.showEdit | default false))
      }}
        <div class="mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
          {{ partial "article-meta.html" (dict "context" . "scope" "single") }}
        </div>
      {{ end }}
    </header>

    <!-- 썸네일: 전체 너비 -->
    {{ with $feature }}
      <div class="w-full mb-8">
        {{ $altText := $.Params.featureAlt | default $.Params.coverAlt | default "" }}
        {{ $class := "w-full" }}
        {{ $webp := $.Page.Site.Params.enableImageWebp | default true }}
        {{ partial "picture.html" (dict "img" . "alt" $altText "class" $class "lazy" false "webp" $webp) }}
        {{ with $.Params.coverCaption }}
          <figcaption class="mt-2 text-center text-neutral-500">{{ . | markdownify }}</figcaption>
        {{ end }}
      </div>
    {{ end }}

    <!-- 본문: 중앙 정렬, 적당한 너비 -->
    <section class="w-full max-w-3xl mx-auto px-4">
      {{ if and (.Params.showTableOfContents | default (.Site.Params.article.showTableOfContents | default false)) (in .TableOfContents "<ul") }}
        <div class="toc mb-8 p-4 bg-neutral-100 dark:bg-neutral-800 rounded-lg print:hidden">
          {{ partial "toc.html" . }}
        </div>
      {{ end }}
      <div class="prose prose-neutral dark:prose-invert max-w-none">
        {{ $content := .Content }}
        {{ $adCode := `<div style="margin: 20px 0; width: 100%;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6677996696534146" crossorigin="anonymous"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6677996696534146" data-ad-slot="5841226790" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>` }}
        {{ $content = replaceRE `(<h2[^>]*>)` (printf "%s$1" $adCode) $content 1 }}
        {{ $content | safeHTML }}
      </div>
    </section>

    <footer class="w-full max-w-3xl mx-auto px-4 pt-8 print:hidden">
      {{ partial "author.html" . }}
      {{ partial "sharing-links.html" . }}
      {{ partial "article-pagination.html" . }}
      {{ if .Params.showComments | default (.Site.Params.article.showComments | default false) }}
        {{ if templates.Exists "_partials/comments.html" }}
          <div class="pt-3">
            <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
            <div class="pt-3">
              {{ partial "comments.html" . }}
            </div>
          </div>
        {{ else }}
          {{ warnf "[CONGO] Comments are enabled for %s but no comments partial exists." .File.Path }}
        {{ end }}
      {{ end }}
    </footer>
  </article>
{{ end }}
